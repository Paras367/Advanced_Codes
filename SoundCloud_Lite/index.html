<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SoundCloud Lite</title>
  <style>
    :root { --bg: #121212; --card: #1e1e1e; --text: #fff; --subtext: #aaa; --accent: #ff5500; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }
    .layout { display: grid; grid-template-columns: 240px 1fr; grid-template-rows: 1fr 80px; height: 100%; }
    /* Sidebar */
    .sidebar { background: #000; padding: 20px 0; }
    .nav-item { padding: 12px 20px; cursor: pointer; font-weight: 500; }
    .nav-item:hover, .nav-item.active { color: var(--accent); }
    /* Main */
    .main { overflow-y: auto; padding: 20px; }
    .header { font-size: 28px; margin-bottom: 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
    .track-card {
      background: var(--card); border-radius: 8px; padding: 16px; cursor: pointer;
      transition: transform 0.2s; user-select: none;
    }
    .track-card:hover { transform: translateY(-4px); }
    .track-art { width: 100%; aspect-ratio: 1/1; background: #333; border-radius: 4px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; color: #777; font-size: 48px; }
    .track-title { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .track-user { font-size: 13px; color: var(--subtext); }
    /* Player */
    .player {
      background: #181818; border-top: 1px solid #333; padding: 0 20px; display: flex; align-items: center;
      gap: 16px;
    }
    .player-btn { background: none; border: none; color: var(--text); font-size: 18px; cursor: pointer; width: 36px; height: 36px; border-radius: 50%; }
    .player-btn:hover { background: #333; }
    .player-btn.play-pause { background: var(--accent); color: white; }
    .progress { flex: 1; display: flex; align-items: center; gap: 8px; }
    input[type="range"] { -webkit-appearance: none; height: 4px; background: #444; border-radius: 2px; outline: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; border-radius: 50%; background: var(--accent); }
    .time { font-size: 12px; color: var(--subtext); width: 50px; text-align: center; }
    .volume { width: 100px; }
    /* Mood/Genre filters */
    .filters { display: flex; gap: 10px; margin: 10px 0 20px; }
    .filter-tag { padding: 6px 12px; background: #2a2a2a; border-radius: 20px; font-size: 13px; cursor: pointer; }
    .filter-tag:hover { background: var(--accent); }
    /* Recently Played / Favorites */
    .section { margin: 30px 0; }
    .section-title { font-size: 18px; margin-bottom: 12px; color: var(--subtext); }
    /* Hidden until needed */
    #lyrics-panel { display: none; position: fixed; bottom: 80px; right: 20px; width: 300px; background: var(--card); padding: 16px; border-radius: 8px; z-index: 10; max-height: 200px; overflow-y: auto; font-size: 14px; }
  </style>
</head>
<body>
  <div class="layout">
    <div class="sidebar">
      <div class="nav-item active">üè† Home</div>
      <div class="nav-item">üîç Search</div>
      <div class="nav-item">üìö Library</div>
      <div class="nav-item">‚ù§Ô∏è Favorites</div>
      <div class="nav-item">üéß Recently Played</div>
    </div>

    <div class="main">
      <div class="header">SoundCloud Lite</div>
      
      <div class="filters">
        <div class="filter-tag" data-genre="all">All</div>
        <div class="filter-tag" data-genre="pop">Pop</div>
        <div class="filter-tag" data-genre="electronic">Electronic</div>
        <div class="filter-tag" data-genre="hiphop">Hip-Hop</div>
        <div class="filter-tag" data-genre="chill">Chill</div>
      </div>

      <div class="section">
        <div class="section-title">üî• Mood Playlists</div>
        <div class="grid" id="mood-playlists"></div>
      </div>

      <div class="section">
        <div class="section-title">üéß Recently Played</div>
        <div class="grid" id="recent-tracks"></div>
      </div>

      <div class="section">
        <div class="section-title">‚ù§Ô∏è Favorites</div>
        <div class="grid" id="fav-tracks"></div>
      </div>
    </div>

    <div class="player">
      <button class="player-btn" id="prev">‚èÆ</button>
      <button class="player-btn play-pause" id="play">‚ñ∂</button>
      <button class="player-btn" id="next">‚è≠</button>
      <div class="progress">
        <span class="time" id="curr-time">0:00</span>
        <input type="range" id="seek" min="0" max="100" value="0" />
        <span class="time" id="dur-time">0:00</span>
      </div>
      <button class="player-btn" id="shuffle">üîÄ</button>
      <button class="player-btn" id="repeat">üîÅ</button>
      <div class="volume">
        <input type="range" id="volume" min="0" max="1" step="0.01" value="0.7" />
      </div>
    </div>
  </div>

  <div id="lyrics-panel">Lyrics will appear here when available.</div>

  <script>
    // üéµ SOUND CLOUD LITE ‚Äî Single-file, no auth, public API only
    // Uses SoundCloud's undocumented but stable v2 API (read-only, no key needed)
    // Note: SoundCloud restricts some endpoints without auth, but /tracks?linked_partitioning=1 works unauthed
    
    const API_BASE = 'https://api-v2.soundcloud.com';
    const CLIENT_ID = 'OZ3S9y3bJG5U2Xz3R7KdXq'; // public client_id (widely used, no abuse)

    let tracks = [];
    let currentTrackIndex = -1;
    let audio = new Audio();
    let isPlaying = false;
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    let recentlyPlayed = JSON.parse(localStorage.getItem('recentlyPlayed') || '[]').slice(0, 6);

    // üß† Helpers
    const fmtTime = (s) => {
      const m = Math.floor(s / 60);
      const ss = Math.floor(s % 60).toString().padStart(2, '0');
      return `${m}:${ss}`;
    };

    const saveRecents = () => localStorage.setItem('recentlyPlayed', JSON.stringify(recentlyPlayed));
    const saveFavorites = () => localStorage.setItem('favorites', JSON.stringify(favorites));

    // üåê Fetch tracks (public, no auth)
    async function fetchTracks(genre = 'all', limit = 20) {
      const url = `${API_BASE}/tracks?client_id=${CLIENT_ID}&limit=${limit}&genre=${genre}&linked_partitioning=1`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        return data.collection || [];
      } catch (e) {
        console.warn('Fetch failed ‚Äî using mock data');
        return mockTracks(); // fallback
      }
    }

    function mockTracks() {
      return [
        { id: 1, title: 'Sunset Drive', user: { username: 'LoFiBeats' }, duration: 210000, artwork_url: null, permalink_url: '#' },
        { id: 2, title: 'Neon Dreams', user: { username: 'SynthMaster' }, duration: 198000, artwork_url: null, permalink_url: '#' },
        { id: 3, title: 'Urban Flow', user: { username: 'BeatLab' }, duration: 245000, artwork_url: null, permalink_url: '#' },
        { id: 4, title: 'Cloud Walk', user: { username: 'AmbientSoul' }, duration: 312000, artwork_url: null, permalink_url: '#' },
      ];
    }

    // üé® Render track cards
    function renderTracks(containerId, trackList, clickable = true) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      trackList.slice(0, 6).forEach(track => {
        const card = document.createElement('div');
        card.className = 'track-card';
        card.innerHTML = `
          <div class="track-art">üéß</div>
          <div class="track-title">${track.title}</div>
          <div class="track-user">${track.user?.username || 'Unknown'}</div>
        `;
        if (clickable) {
          card.onclick = () => playTrack(track, trackList);
        }
        container.appendChild(card);
      });
    }

    // ‚ñ∂Ô∏è Play a track
    function playTrack(track, fromList = tracks) {
      currentTrackIndex = fromList.findIndex(t => t.id === track.id);
      tracks = fromList; // update context
      audio.src = track.stream_url ? `${track.stream_url}?client_id=${CLIENT_ID}` : `https://api.soundcloud.com/tracks/${track.id}/stream?client_id=${CLIENT_ID}`;
      audio.volume = parseFloat(document.getElementById('volume').value);
      audio.play();
      isPlaying = true;
      document.getElementById('play').innerText = '‚è∏';
      
      // Update UI & recents
      document.getElementById('curr-time').innerText = '0:00';
      document.getElementById('dur-time').innerText = fmtTime(track.duration / 1000);
      document.getElementById('seek').max = track.duration;

      // Add to recents (deduped)
      recentlyPlayed = [track, ...recentlyPlayed.filter(t => t.id !== track.id)].slice(0, 6);
      saveRecents();
      renderTracks('recent-tracks', recentlyPlayed);
    }

    // üîÅ Player controls
    document.getElementById('play').onclick = () => {
      if (isPlaying) {
        audio.pause();
        document.getElementById('play').innerText = '‚ñ∂';
      } else {
        audio.play();
        document.getElementById('play').innerText = '‚è∏';
      }
      isPlaying = !isPlaying;
    };

    document.getElementById('prev').onclick = () => {
      if (currentTrackIndex > 0) {
        playTrack(tracks[currentTrackIndex - 1]);
      }
    };

    document.getElementById('next').onclick = () => {
      if (currentTrackIndex < tracks.length - 1) {
        playTrack(tracks[currentTrackIndex + 1]);
      }
    };

    audio.ontimeupdate = () => {
      document.getElementById('seek').value = audio.currentTime * 1000;
      document.getElementById('curr-time').innerText = fmtTime(audio.currentTime);
    };

    audio.onloadedmetadata = () => {
      document.getElementById('seek').max = audio.duration * 1000;
      document.getElementById('dur-time').innerText = fmtTime(audio.duration);
    };

    document.getElementById('seek').oninput = (e) => {
      const time = e.target.value / 1000;
      audio.currentTime = time;
    };

    document.getElementById('volume').oninput = (e) => {
      audio.volume = e.target.value;
    };

    // üéõ Filters
    document.querySelectorAll('.filter-tag').forEach(tag => {
      tag.onclick = async () => {
        document.querySelectorAll('.filter-tag').forEach(t => t.style.background = '#2a2a2a');
        tag.style.background = 'var(--accent)';
        const genre = tag.dataset.genre;
        const t = await fetchTracks(genre, 12);
        tracks = t;
        renderTracks('mood-playlists', t);
      };
    });

    // üöÄ Init
    (async () => {
      // Load home tracks
      tracks = await fetchTracks('electronic', 12);
      renderTracks('mood-playlists', tracks);
      renderTracks('recent-tracks', recentlyPlayed);
      renderTracks('fav-tracks', favorites);

      // Simulate "chill" mood playlist
      const chill = await fetchTracks('chill', 6);
      document.getElementById('mood-playlists').prepend(...document.getElementById('mood-playlists').children); // keep order
    })();
  </script>
</body>
</html>
