

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NEXUS GRID</title>
  <meta name="description" content="Fueling the future with code and creativity">
  
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">

  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <meta property="og:title" content="SoftwareLabs">
  <meta property="og:description" content="Digital innovation by young minds">
  <meta property="og:type" content="website">
  <meta name="robots" content="index, follow">
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    @keyframes neon-pulse {
      0%, 100% { text-shadow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 30px #0ff, 0 0 40px #0ff; }
      50% { text-shadow: 0 0 5px #0ff, 0 0 10px #0ff, 0 0 15px #0ff, 0 0 20px #0ff; }
    }
    .neon-glow {
      animation: neon-pulse 2s infinite;
      color: #0ff;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .float-animation { animation: float 3s ease-in-out infinite; }
    
    @keyframes tile-pop {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    .tile-appear { animation: tile-pop 0.3s ease-out; }
    
    @keyframes glow-pulse {
      0% { box-shadow: 0 0 5px rgba(0, 255, 255, 0.5); }
      50% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.6); }
      100% { box-shadow: 0 0 5px rgba(0, 255, 255, 0.5); }
    }
    
    .tile-2 { background: linear-gradient(135deg, #1a1a2e, #16213e); }
    .tile-4 { background: linear-gradient(135deg, #16213e, #0f3460); }
    .tile-8 { background: linear-gradient(135deg, #0f3460, #533483); color: #fff; }
    .tile-16 { background: linear-gradient(135deg, #e94560, #ff6b9d); color: white; box-shadow: 0 0 15px #e94560, 0 0 25px rgba(233, 69, 96, 0.5); }
    .tile-32 { background: linear-gradient(135deg, #ff6b9d, #ffa07a); color: white; box-shadow: 0 0 18px #ff6b9d, 0 0 30px rgba(255, 107, 157, 0.5); }
    .tile-64 { background: linear-gradient(135deg, #ffa07a, #ffcc70); color: white; box-shadow: 0 0 20px #ffa07a, 0 0 35px rgba(255, 160, 122, 0.5); }
    .tile-128 { background: linear-gradient(135deg, #ffcc70, #f7d794); color: black; box-shadow: 0 0 25px #ffcc70, 0 0 40px rgba(255, 204, 112, 0.6); font-size: 0.9rem; }
    .tile-256 { background: linear-gradient(135deg, #f7d794, #c4e538); color: black; box-shadow: 0 0 28px #f7d794, 0 0 45px rgba(247, 215, 148, 0.6); font-size: 0.9rem; }
    .tile-512 { background: linear-gradient(135deg, #38ef7d, #11998e); color: white; box-shadow: 0 0 30px #38ef7d, 0 0 50px rgba(56, 239, 125, 0.7); font-size: 0.85rem; }
    .tile-1024 { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; box-shadow: 0 0 35px #4facfe, 0 0 55px rgba(79, 172, 254, 0.7); font-size: 0.8rem; }
    .tile-2048 { background: linear-gradient(135deg, #a8edea, #fed6e3); color: black; box-shadow: 0 0 40px #a8edea, 0 0 60px rgba(168, 237, 234, 0.8); font-size: 0.75rem; font-weight: 900; }
    
    @keyframes obstacle-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .obstacle-icon { animation: obstacle-spin 4s linear infinite; }
    
    @keyframes power-pulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.2); filter: brightness(1.5); }
    }
    .power-icon { animation: power-pulse 1s infinite; }
    
    @keyframes bg-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .animated-bg {
      background: linear-gradient(45deg, #0a0e27, #16213e, #1a1a2e, #0a0e27);
      background-size: 400% 400%;
      animation: bg-shift 15s ease infinite;
    }
    
    @keyframes slide-in {
      from { transform: translateY(-100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .slide-in { animation: slide-in 0.5s ease-out; }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .shake-animation { animation: shake 0.3s ease-in-out; }
    
    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #0ff;
      border-radius: 50%;
      pointer-events: none;
      animation: particle-float 2s ease-out forwards;
    }
    
    @keyframes particle-float {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-100px) scale(0); opacity: 0; }
    }
    
    .grid-glow {
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3), 0 0 40px rgba(0, 255, 255, 0.2), inset 0 0 20px rgba(0, 255, 255, 0.1);
    }
  </style>
</head>
<body class="min-h-screen animated-bg text-white flex items-center justify-center p-4 overflow-hidden">
  
  <!-- Particle Background -->
  <div id="particles" class="fixed inset-0 pointer-events-none opacity-30"></div>
  
  <div id="root">
    <div class="text-center">
      <i class="fas fa-spinner fa-spin text-cyan-400 text-3xl"></i>
      <p class="mt-2 text-gray-400">Loading NEXUS GRID...</p>
    </div>
  </div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    // Particle Background Effect
    const createParticles = () => {
      const container = document.getElementById('particles');
      setInterval(() => {
        if (Math.random() > 0.7) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * window.innerWidth + 'px';
          particle.style.top = window.innerHeight + 'px';
          container.appendChild(particle);
          setTimeout(() => particle.remove(), 2000);
        }
      }, 200);
    };
    createParticles();

    // ==================== API Service ====================
    const API_URL = 'https://nexus-grid-api.dhimanparas605.workers.dev';

    class NexusAPI {
      constructor() {
        this.token = this.getStoredToken();
      }

      getStoredToken() {
        try {
          return sessionStorage.getItem('nexus_token');
        } catch {
          return null;
        }
      }

      setToken(token) {
        this.token = token;
        try {
          sessionStorage.setItem('nexus_token', token);
        } catch {}
      }

      async login(username) {
        const res = await fetch(`${API_URL}/api/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        const data = await res.json();
        if (data.token) {
          this.setToken(data.token);
          return data.profile;
        }
        throw new Error(data.error || 'Login failed');
      }

      async saveProfile(updates) {
        if (!this.token) return;
        await fetch(`${API_URL}/api/profile`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-Nexus-Token': this.token
          },
          body: JSON.stringify(updates)
        });
      }
    }

    // ==================== Game Engine ====================
    const GameEngine = {
      generateMazeGrid() {
        const grid = Array(4).fill().map(() => Array(4).fill(null));
        this.addRandomTile(grid);
        this.addRandomTile(grid);
        
        for (let i = 0; i < 2; i++) {
          let r, c;
          do {
            r = Math.floor(Math.random() * 4);
            c = Math.floor(Math.random() * 4);
          } while (grid[r][c] !== null);
          grid[r][c] = 'OBSTACLE';
        }
        
        let pr, pc;
        do {
          pr = Math.floor(Math.random() * 4);
          pc = Math.floor(Math.random() * 4);
        } while (grid[pr][pc] !== null);
        grid[pr][pc] = 'POWER';
        return grid;
      },

      addRandomTile(grid) {
        const empty = [];
        for (let r = 0; r < 4; r++) {
          for (let c = 0; c < 4; c++) {
            if (grid[r][c] === null) empty.push([r, c]);
          }
        }
        if (empty.length > 0) {
          const [r, c] = empty[Math.floor(Math.random() * empty.length)];
          grid[r][c] = Math.random() < 0.9 ? 2 : 4;
        }
      },

      moveLeft(grid) {
        let moved = false;
        for (let r = 0; r < 4; r++) {
          const row = grid[r].filter(cell => typeof cell === 'number');
          for (let i = 0; i < row.length - 1; i++) {
            if (row[i] === row[i + 1]) {
              row[i] *= 2;
              row[i + 1] = null;
              i++;
            }
          }
          const newRow = row.filter(x => x !== null);
          while (newRow.length < 4) newRow.push(null);
          for (let c = 0; c < 4; c++) {
            if (grid[r][c] !== newRow[c]) moved = true;
            grid[r][c] = newRow[c];
          }
        }
        return moved;
      },

      rotateGrid(grid) {
        return grid[0].map((_, i) => grid.map(row => row[i]).reverse());
      },

      checkGameOver(grid) {
        for (let dir of ['ArrowLeft', 'ArrowUp', 'ArrowRight', 'ArrowDown']) {
          let testGrid = JSON.parse(JSON.stringify(grid));
          let r = dir === 'ArrowUp' ? 1 : dir === 'ArrowRight' ? 2 : dir === 'ArrowDown' ? 3 : 0;
          for (let i = 0; i < r; i++) testGrid = this.rotateGrid(testGrid);
          if (this.moveLeft(testGrid)) return false;
        }
        return true;
      },

      getHighestTile(grid) {
        return Math.max(...grid.flat().filter(x => typeof x === 'number'));
      }
    };

    // ==================== Components ====================
    const GridCell = ({ cell, isNew }) => {
      const getCellContent = () => {
        if (cell === 'OBSTACLE') return <i className="fas fa-radiation obstacle-icon text-red-500 text-2xl"></i>;
        if (cell === 'POWER') return <i className="fas fa-bolt power-icon text-yellow-300 text-2xl"></i>;
        if (typeof cell === 'number') {
          const icons = {
            2: 'cube', 4: 'dice-four', 8: 'fire', 16: 'gem', 32: 'crown',
            64: 'star', 128: 'medal', 256: 'trophy', 512: 'rocket', 1024: 'dragon', 2048: 'infinity'
          };
          return (
            <div className="flex flex-col items-center justify-center gap-1">
              <i className={`fas fa-${icons[cell] || 'circle'} text-sm`}></i>
              <span>{cell}</span>
            </div>
          );
        }
        return null;
      };

      const getCellClass = () => {
        let cls = 'w-16 h-16 md:w-20 md:h-20 rounded-lg flex items-center justify-center text-xl font-bold transition-all duration-200 border-2 ';
        if (isNew) cls += 'tile-appear ';
        if (cell === 'OBSTACLE') {
          cls += 'bg-gray-900 border-red-900 shadow-lg shadow-red-900/50';
        } else if (cell === 'POWER') {
          cls += 'bg-gradient-to-br from-yellow-900 to-yellow-700 border-yellow-500 shadow-lg shadow-yellow-500/50';
        } else if (typeof cell === 'number') {
          cls += `tile-${cell} border-white/20`;
        } else {
          cls += 'bg-gray-900/50 border-cyan-900/30 backdrop-blur-sm';
        }
        return cls;
      };

      return <div className={getCellClass()}>{getCellContent()}</div>;
    };

    const ScoreBoard = ({ username, score, highScore, moves }) => (
      <div className="w-full max-w-md mb-6 px-4 slide-in">
        <div className="bg-gray-900/70 backdrop-blur-md rounded-xl p-4 border-2 border-cyan-500/30 shadow-xl">
          <div className="flex justify-between items-center mb-3">
            <div className="flex items-center gap-2 text-cyan-400 font-mono text-lg">
              <i className="fas fa-user-astronaut"></i>
              <span className="font-bold">{username}</span>
            </div>
            <div className="flex items-center gap-2 text-purple-400">
              <i className="fas fa-walking"></i>
              <span className="font-bold">{moves}</span>
            </div>
          </div>
          <div className="flex justify-between items-center">
            <div className="flex items-center gap-2">
              <i className="fas fa-star text-yellow-400"></i>
              <div>
                <div className="text-xs text-gray-400">Current</div>
                <div className="text-xl font-bold text-yellow-400">{score}</div>
              </div>
            </div>
            {highScore > 0 && (
              <div className="flex items-center gap-2">
                <i className="fas fa-crown text-purple-400"></i>
                <div>
                  <div className="text-xs text-gray-400">Best</div>
                  <div className="text-xl font-bold text-purple-400">{highScore}</div>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    );

    const LoginScreen = ({ onLogin }) => {
      const [username, setUsername] = React.useState('');
      const [loading, setLoading] = React.useState(false);

      const handleSubmit = async () => {
        if (username.trim().length < 3) return;
        setLoading(true);
        try {
          const profile = await new NexusAPI().login(username.trim());
          onLogin(profile);
        } catch (err) {
          alert(err.message);
        }
        setLoading(false);
      };

      const handleKeyPress = (e) => e.key === 'Enter' && handleSubmit();

      return (
        <div className="text-center p-6 max-w-md mx-auto slide-in">
          <div className="float-animation mb-8">
            <i className="fas fa-brain text-6xl text-cyan-400 mb-4 inline-block"></i>
            <h1 className="text-6xl font-bold mb-2 neon-glow">NEXUS GRID</h1>
            <p className="text-cyan-400 mb-2 font-mono text-lg"><i className="fas fa-code"></i> Enter the Matrix <i className="fas fa-code"></i></p>
            <div className="flex justify-center gap-3 text-2xl text-gray-500">
              <i className="fas fa-microchip"></i>
              <i className="fas fa-network-wired"></i>
              <i className="fas fa-server"></i>
            </div>
          </div>
          <div className="space-y-4 bg-gray-900/70 backdrop-blur-md p-6 rounded-xl border-2 border-cyan-500/30">
            <div className="relative">
              <i className="fas fa-terminal absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-400"></i>
              <input
                type="text"
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Enter username (min 3 chars)"
                className="w-full p-3 pl-10 rounded-lg bg-gray-800 border-2 border-cyan-500 text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-transparent transition"
                disabled={loading}
                autoFocus
              />
            </div>
            <button
              onClick={handleSubmit}
              disabled={loading || username.length < 3}
              className="w-full py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:from-gray-700 disabled:to-gray-700 rounded-lg font-bold transition transform hover:scale-105 shadow-lg"
            >
              {loading ? (
                <><i className="fas fa-spinner fa-spin mr-2"></i>Connecting...</>
              ) : (
                <><i className="fas fa-play mr-2"></i>Enter Grid</>
              )}
            </button>
          </div>
        </div>
      );
    };

    const GameBoard = ({ profile, onGameOver }) => {
      const [grid, setGrid] = React.useState(GameEngine.generateMazeGrid());
      const [score, setScore] = React.useState(0);
      const [highScore, setHighScore] = React.useState(profile.highestTile || 0);
      const [gameOver, setGameOver] = React.useState(false);
      const [moves, setMoves] = React.useState(0);
      const [newTiles, setNewTiles] = React.useState(new Set());

      const handleMove = (direction) => {
        if (gameOver) return;
        let newGrid = JSON.parse(JSON.stringify(grid));
        let rotations = direction === 'ArrowUp' ? 1 : direction === 'ArrowRight' ? 2 : direction === 'ArrowDown' ? 3 : 0;
        for (let i = 0; i < rotations; i++) newGrid = GameEngine.rotateGrid(newGrid);
        const moved = GameEngine.moveLeft(newGrid);
        for (let i = 0; i < (4 - rotations) % 4; i++) newGrid = GameEngine.rotateGrid(newGrid);
        if (moved) {
          GameEngine.addRandomTile(newGrid);
          setGrid(newGrid);
          setMoves(m => m + 1);
          const currentHighest = GameEngine.getHighestTile(newGrid);
          setScore(currentHighest);
          if (currentHighest > highScore) setHighScore(currentHighest);
          if (GameEngine.checkGameOver(newGrid)) {
            setGameOver(true);
            onGameOver({ score: currentHighest, highestTile: currentHighest, moves });
          }
        }
      };

      React.useEffect(() => {
        const keyHandler = (e) => {
          if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown'].includes(e.key)) {
            e.preventDefault();
            handleMove(e.key);
          }
        };
        window.addEventListener('keydown', keyHandler);
        return () => window.removeEventListener('keydown', keyHandler);
      }, [grid, gameOver]);

      const handleRestart = () => {
        setGrid(GameEngine.generateMazeGrid());
        setScore(0);
        setGameOver(false);
        setMoves(0);
      };

      return (
        <div className="flex flex-col items-center">
          <ScoreBoard username={profile.username} score={score} highScore={highScore} moves={moves} />
          
          <div className="grid grid-cols-4 gap-3 p-5 bg-gray-900/70 backdrop-blur-md rounded-2xl border-2 border-cyan-500/30 mb-6 grid-glow shadow-2xl">
            {grid.flat().map((cell, idx) => <GridCell key={idx} cell={cell} />)}
          </div>
          
          <div className="flex gap-4 mb-4">
            <div className="flex items-center gap-2 px-4 py-2 bg-gray-800/70 rounded-lg border border-cyan-500/30">
              <i className="fas fa-keyboard text-cyan-400"></i>
              <span className="text-sm text-gray-300">Use Arrow Keys</span>
            </div>
            <button 
              onClick={handleRestart}
              className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded-lg transition transform hover:scale-105"
            >
              <i className="fas fa-redo"></i>
              <span>Restart</span>
            </button>
          </div>
          
          {gameOver && (
            <div className="p-8 bg-gradient-to-br from-red-900/90 to-purple-900/90 backdrop-blur-md border-4 border-red-500 rounded-2xl text-center space-y-4 shadow-2xl shake-animation max-w-md">
              <i className="fas fa-skull-crossbones text-6xl text-red-400 mb-2"></i>
              <div className="text-3xl font-bold text-red-400">GAME OVER</div>
              <div className="text-gray-300">Your journey ends here...</div>
              <div className="flex justify-around text-lg">
                <div>
                  <i className="fas fa-star text-yellow-400 mr-1"></i>
                  <span className="text-yellow-400 font-bold">{score}</span>
                </div>
                <div>
                  <i className="fas fa-walking text-purple-400 mr-1"></i>
                  <span className="text-purple-400 font-bold">{moves}</span>
                </div>
              </div>
              <button 
                onClick={handleRestart} 
                className="px-6 py-3 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 rounded-lg font-bold transition transform hover:scale-105 shadow-lg w-full"
              >
                <i className="fas fa-sync-alt mr-2"></i>Try Again
              </button>
            </div>
          )}
        </div>
      );
    };

    // ==================== Main App ====================
    const App = () => {
      const [profile, setProfile] = React.useState(null);
      const [gameState, setGameState] = React.useState('login');

      const handleLogin = (prof) => {
        setProfile(prof);
        setGameState('playing');
      };

      const handleGameOver = async (stats) => {
        await new NexusAPI().saveProfile({
          totalGames: 1,
          highestTile: stats.highestTile,
          moves: stats.moves
        });
      };

      return gameState === 'login' ? (
        <LoginScreen onLogin={handleLogin} />
      ) : (
        <GameBoard profile={profile} onGameOver={handleGameOver} />
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

  <div class="fixed bottom-4 right-4 text-xs text-gray-400 bg-gray-900/50 backdrop-blur-sm px-3 py-2 rounded-lg border border-cyan-900/30">
    <p><i class="fas fa-copyright mr-1"></i>SoftwareLabs</p>
    <p><i class="fas fa-code mr-1"></i>By: Paras Dhiman</p>
  </div>
</body>
</html>
